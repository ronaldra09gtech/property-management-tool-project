import{c as vs,R as M,s as pe,h as ws,b as ps,j as c}from"./index-Balmp9Wm.js";import{u as He,a as $e}from"./useMutation-Dpa1Kpty.js";import{C as _s}from"./camera-Cul3T2a2.js";import{C as Fs}from"./clock-Cx-_l5Rb.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=vs("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);var ye=e=>e.type==="checkbox",ie=e=>e instanceof Date,T=e=>e==null;const is=e=>typeof e=="object";var A=e=>!T(e)&&!Array.isArray(e)&&is(e)&&!ie(e),As=e=>A(e)&&e.target?ye(e.target)?e.target.checked:e.target.value:e,Vs=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,js=(e,t)=>e.has(Vs(t)),ks=e=>{const t=e.constructor&&e.constructor.prototype;return A(t)&&t.hasOwnProperty("isPrototypeOf")},De=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function W(e){let t;const r=Array.isArray(e),a=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else if(!(De&&(e instanceof Blob||a))&&(r||A(e)))if(t=r?[]:{},!r&&!ks(e))t=e;else for(const o in e)e.hasOwnProperty(o)&&(t[o]=W(e[o]));else return e;return t}var _e=e=>Array.isArray(e)?e.filter(Boolean):[],j=e=>e===void 0,y=(e,t,r)=>{if(!t||!A(e))return r;const a=_e(t.split(/[,[\].]+?/)).reduce((o,l)=>T(o)?o:o[l],e);return j(a)||a===e?j(e[t])?r:e[t]:a},J=e=>typeof e=="boolean",Ee=e=>/^\w*$/.test(e),as=e=>_e(e.replace(/["|']|\]/g,"").split(/\.|\[/)),F=(e,t,r)=>{let a=-1;const o=Ee(t)?[t]:as(t),l=o.length,m=l-1;for(;++a<l;){const g=o[a];let C=r;if(a!==m){const O=e[g];C=A(O)||Array.isArray(O)?O:isNaN(+o[a+1])?{}:[]}if(g==="__proto__"||g==="constructor"||g==="prototype")return;e[g]=C,e=e[g]}return e};const Qe={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Y={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ee={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};M.createContext(null);var Ps=(e,t,r,a=!0)=>{const o={defaultValues:t._defaultValues};for(const l in e)Object.defineProperty(o,l,{get:()=>{const m=l;return t._proxyFormState[m]!==Y.all&&(t._proxyFormState[m]=!a||Y.all),e[m]}});return o},q=e=>A(e)&&!Object.keys(e).length,Ss=(e,t,r,a)=>{r(e);const{name:o,...l}=e;return q(l)||Object.keys(l).length>=Object.keys(t).length||Object.keys(l).find(m=>t[m]===Y.all)},he=e=>Array.isArray(e)?e:[e];function Ds(e){const t=M.useRef(e);t.current=e,M.useEffect(()=>{const r=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{r&&r.unsubscribe()}},[e.disabled])}var Z=e=>typeof e=="string",Es=(e,t,r,a,o)=>Z(e)?(a&&t.watch.add(e),y(r,e,o)):Array.isArray(e)?e.map(l=>(a&&t.watch.add(l),y(r,l))):(a&&(t.watchAll=!0),r),Cs=(e,t,r,a,o)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[a]:o||!0}}:{},ze=e=>({isOnSubmit:!e||e===Y.onSubmit,isOnBlur:e===Y.onBlur,isOnChange:e===Y.onChange,isOnAll:e===Y.all,isOnTouch:e===Y.onTouched}),Ye=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(a=>e.startsWith(a)&&/^\.\w+/.test(e.slice(a.length))));const me=(e,t,r,a)=>{for(const o of r||Object.keys(e)){const l=y(e,o);if(l){const{_f:m,...g}=l;if(m){if(m.refs&&m.refs[0]&&t(m.refs[0],o)&&!a)return!0;if(m.ref&&t(m.ref,m.name)&&!a)return!0;if(me(g,t))break}else if(A(g)&&me(g,t))break}}};var Us=(e,t,r)=>{const a=he(y(e,r));return F(a,"root",t[r]),F(e,r,a),e},Ce=e=>e.type==="file",X=e=>typeof e=="function",be=e=>{if(!De)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},xe=e=>Z(e),Ue=e=>e.type==="radio",ve=e=>e instanceof RegExp;const Ge={value:!1,isValid:!1},Je={value:!0,isValid:!0};var ns=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!j(e[0].attributes.value)?j(e[0].value)||e[0].value===""?Je:{value:e[0].value,isValid:!0}:Je:Ge}return Ge};const Xe={isValid:!1,value:null};var ls=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,Xe):Xe;function Ze(e,t,r="validate"){if(xe(e)||Array.isArray(e)&&e.every(xe)||J(e)&&!e)return{type:r,message:xe(e)?e:"",ref:t}}var le=e=>A(e)&&!ve(e)?e:{value:e,message:""},es=async(e,t,r,a,o,l)=>{const{ref:m,refs:g,required:C,maxLength:O,minLength:N,min:b,max:ae,pattern:V,validate:H,name:S,valueAsNumber:R,mount:I}=e._f,p=y(r,S);if(!I||t.has(S))return{};const $=g?g[0]:m,Q=w=>{o&&$.reportValidity&&($.setCustomValidity(J(w)?"":w||""),$.reportValidity())},x={},U=Ue(m),te=ye(m),G=U||te,ne=(R||Ce(m))&&j(m.value)&&j(p)||be(m)&&m.value===""||p===""||Array.isArray(p)&&!p.length,B=Cs.bind(null,S,a,x),ge=(w,_,k,L=ee.maxLength,z=ee.minLength)=>{const K=w?_:k;x[S]={type:w?L:z,message:K,ref:m,...B(w?L:z,K)}};if(l?!Array.isArray(p)||!p.length:C&&(!G&&(ne||T(p))||J(p)&&!p||te&&!ns(g).isValid||U&&!ls(g).isValid)){const{value:w,message:_}=xe(C)?{value:!!C,message:C}:le(C);if(w&&(x[S]={type:ee.required,message:_,ref:$,...B(ee.required,_)},!a))return Q(_),x}if(!ne&&(!T(b)||!T(ae))){let w,_;const k=le(ae),L=le(b);if(!T(p)&&!isNaN(p)){const z=m.valueAsNumber||p&&+p;T(k.value)||(w=z>k.value),T(L.value)||(_=z<L.value)}else{const z=m.valueAsDate||new Date(p),K=ue=>new Date(new Date().toDateString()+" "+ue),oe=m.type=="time",de=m.type=="week";Z(k.value)&&p&&(w=oe?K(p)>K(k.value):de?p>k.value:z>new Date(k.value)),Z(L.value)&&p&&(_=oe?K(p)<K(L.value):de?p<L.value:z<new Date(L.value))}if((w||_)&&(ge(!!w,k.message,L.message,ee.max,ee.min),!a))return Q(x[S].message),x}if((O||N)&&!ne&&(Z(p)||l&&Array.isArray(p))){const w=le(O),_=le(N),k=!T(w.value)&&p.length>+w.value,L=!T(_.value)&&p.length<+_.value;if((k||L)&&(ge(k,w.message,_.message),!a))return Q(x[S].message),x}if(V&&!ne&&Z(p)){const{value:w,message:_}=le(V);if(ve(w)&&!p.match(w)&&(x[S]={type:ee.pattern,message:_,ref:m,...B(ee.pattern,_)},!a))return Q(_),x}if(H){if(X(H)){const w=await H(p,r),_=Ze(w,$);if(_&&(x[S]={..._,...B(ee.validate,_.message)},!a))return Q(_.message),x}else if(A(H)){let w={};for(const _ in H){if(!q(w)&&!a)break;const k=Ze(await H[_](p,r),$,_);k&&(w={...k,...B(_,k.message)},Q(k.message),a&&(x[S]=w))}if(!q(w)&&(x[S]={ref:$,...w},!a))return x}}return Q(!0),x};function Ls(e,t){const r=t.slice(0,-1).length;let a=0;for(;a<r;)e=j(e)?a++:e[t[a++]];return e}function Os(e){for(const t in e)if(e.hasOwnProperty(t)&&!j(e[t]))return!1;return!0}function P(e,t){const r=Array.isArray(t)?t:Ee(t)?[t]:as(t),a=r.length===1?e:Ls(e,r),o=r.length-1,l=r[o];return a&&delete a[l],o!==0&&(A(a)&&q(a)||Array.isArray(a)&&Os(a))&&P(e,r.slice(0,-1)),e}var je=()=>{let e=[];return{get observers(){return e},next:o=>{for(const l of e)l.next&&l.next(o)},subscribe:o=>(e.push(o),{unsubscribe:()=>{e=e.filter(l=>l!==o)}}),unsubscribe:()=>{e=[]}}},Se=e=>T(e)||!is(e);function re(e,t){if(Se(e)||Se(t))return e===t;if(ie(e)&&ie(t))return e.getTime()===t.getTime();const r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(const o of r){const l=e[o];if(!a.includes(o))return!1;if(o!=="ref"){const m=t[o];if(ie(l)&&ie(m)||A(l)&&A(m)||Array.isArray(l)&&Array.isArray(m)?!re(l,m):l!==m)return!1}}return!0}var os=e=>e.type==="select-multiple",Ts=e=>Ue(e)||ye(e),ke=e=>be(e)&&e.isConnected,ds=e=>{for(const t in e)if(X(e[t]))return!0;return!1};function we(e,t={}){const r=Array.isArray(e);if(A(e)||r)for(const a in e)Array.isArray(e[a])||A(e[a])&&!ds(e[a])?(t[a]=Array.isArray(e[a])?[]:{},we(e[a],t[a])):T(e[a])||(t[a]=!0);return t}function us(e,t,r){const a=Array.isArray(e);if(A(e)||a)for(const o in e)Array.isArray(e[o])||A(e[o])&&!ds(e[o])?j(t)||Se(r[o])?r[o]=Array.isArray(e[o])?we(e[o],[]):{...we(e[o])}:us(e[o],T(t)?{}:t[o],r[o]):r[o]=!re(e[o],t[o]);return r}var ce=(e,t)=>us(e,t,we(t)),cs=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:a})=>j(e)?e:t?e===""?NaN:e&&+e:r&&Z(e)?new Date(e):a?a(e):e;function Pe(e){const t=e.ref;return Ce(t)?t.files:Ue(t)?ls(e.refs).value:os(t)?[...t.selectedOptions].map(({value:r})=>r):ye(t)?ns(e.refs).value:cs(j(t.value)?e.ref.value:t.value,e)}var Rs=(e,t,r,a)=>{const o={};for(const l of e){const m=y(t,l);m&&F(o,l,m._f)}return{criteriaMode:r,names:[...e],fields:o,shouldUseNativeValidation:a}},fe=e=>j(e)?e:ve(e)?e.source:A(e)?ve(e.value)?e.value.source:e.value:e;const ss="AsyncFunction";var qs=e=>!!e&&!!e.validate&&!!(X(e.validate)&&e.validate.constructor.name===ss||A(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===ss)),Ms=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function rs(e,t,r){const a=y(e,r);if(a||Ee(r))return{error:a,name:r};const o=r.split(".");for(;o.length;){const l=o.join("."),m=y(t,l),g=y(e,l);if(m&&!Array.isArray(m)&&r!==l)return{name:r};if(g&&g.type)return{name:l,error:g};o.pop()}return{name:r}}var Is=(e,t,r,a,o)=>o.isOnAll?!1:!r&&o.isOnTouch?!(t||e):(r?a.isOnBlur:o.isOnBlur)?!e:(r?a.isOnChange:o.isOnChange)?e:!0,Bs=(e,t)=>!_e(y(e,t)).length&&P(e,t);const Ks={mode:Y.onSubmit,reValidateMode:Y.onChange,shouldFocusError:!0};function Ws(e={}){let t={...Ks,...e},r={submitCount:0,isDirty:!1,isLoading:X(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},o=A(t.defaultValues)||A(t.values)?W(t.defaultValues||t.values)||{}:{},l=t.shouldUnregister?{}:W(o),m={action:!1,mount:!1,watch:!1},g={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},C,O=0;const N={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},b={values:je(),array:je(),state:je()},ae=ze(t.mode),V=ze(t.reValidateMode),H=t.criteriaMode===Y.all,S=s=>i=>{clearTimeout(O),O=setTimeout(s,i)},R=async s=>{if(!t.disabled&&(N.isValid||s)){const i=t.resolver?q((await G()).errors):await B(a,!0);i!==r.isValid&&b.state.next({isValid:i})}},I=(s,i)=>{!t.disabled&&(N.isValidating||N.validatingFields)&&((s||Array.from(g.mount)).forEach(n=>{n&&(i?F(r.validatingFields,n,i):P(r.validatingFields,n))}),b.state.next({validatingFields:r.validatingFields,isValidating:!q(r.validatingFields)}))},p=(s,i=[],n,f,u=!0,d=!0)=>{if(f&&n&&!t.disabled){if(m.action=!0,d&&Array.isArray(y(a,s))){const h=n(y(a,s),f.argA,f.argB);u&&F(a,s,h)}if(d&&Array.isArray(y(r.errors,s))){const h=n(y(r.errors,s),f.argA,f.argB);u&&F(r.errors,s,h),Bs(r.errors,s)}if(N.touchedFields&&d&&Array.isArray(y(r.touchedFields,s))){const h=n(y(r.touchedFields,s),f.argA,f.argB);u&&F(r.touchedFields,s,h)}N.dirtyFields&&(r.dirtyFields=ce(o,l)),b.state.next({name:s,isDirty:w(s,i),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else F(l,s,i)},$=(s,i)=>{F(r.errors,s,i),b.state.next({errors:r.errors})},Q=s=>{r.errors=s,b.state.next({errors:r.errors,isValid:!1})},x=(s,i,n,f)=>{const u=y(a,s);if(u){const d=y(l,s,j(n)?y(o,s):n);j(d)||f&&f.defaultChecked||i?F(l,s,i?d:Pe(u._f)):L(s,d),m.mount&&R()}},U=(s,i,n,f,u)=>{let d=!1,h=!1;const v={name:s};if(!t.disabled){const D=!!(y(a,s)&&y(a,s)._f&&y(a,s)._f.disabled);if(!n||f){N.isDirty&&(h=r.isDirty,r.isDirty=v.isDirty=w(),d=h!==v.isDirty);const E=D||re(y(o,s),i);h=!!(!D&&y(r.dirtyFields,s)),E||D?P(r.dirtyFields,s):F(r.dirtyFields,s,!0),v.dirtyFields=r.dirtyFields,d=d||N.dirtyFields&&h!==!E}if(n){const E=y(r.touchedFields,s);E||(F(r.touchedFields,s,n),v.touchedFields=r.touchedFields,d=d||N.touchedFields&&E!==n)}d&&u&&b.state.next(v)}return d?v:{}},te=(s,i,n,f)=>{const u=y(r.errors,s),d=N.isValid&&J(i)&&r.isValid!==i;if(t.delayError&&n?(C=S(()=>$(s,n)),C(t.delayError)):(clearTimeout(O),C=null,n?F(r.errors,s,n):P(r.errors,s)),(n?!re(u,n):u)||!q(f)||d){const h={...f,...d&&J(i)?{isValid:i}:{},errors:r.errors,name:s};r={...r,...h},b.state.next(h)}},G=async s=>{I(s,!0);const i=await t.resolver(l,t.context,Rs(s||g.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return I(s),i},ne=async s=>{const{errors:i}=await G(s);if(s)for(const n of s){const f=y(i,n);f?F(r.errors,n,f):P(r.errors,n)}else r.errors=i;return i},B=async(s,i,n={valid:!0})=>{for(const f in s){const u=s[f];if(u){const{_f:d,...h}=u;if(d){const v=g.array.has(d.name),D=u._f&&qs(u._f);D&&N.validatingFields&&I([f],!0);const E=await es(u,g.disabled,l,H,t.shouldUseNativeValidation&&!i,v);if(D&&N.validatingFields&&I([f]),E[d.name]&&(n.valid=!1,i))break;!i&&(y(E,d.name)?v?Us(r.errors,E,d.name):F(r.errors,d.name,E[d.name]):P(r.errors,d.name))}!q(h)&&await B(h,i,n)}}return n.valid},ge=()=>{for(const s of g.unMount){const i=y(a,s);i&&(i._f.refs?i._f.refs.every(n=>!ke(n)):!ke(i._f.ref))&&Fe(s)}g.unMount=new Set},w=(s,i)=>!t.disabled&&(s&&i&&F(l,s,i),!re(Le(),o)),_=(s,i,n)=>Es(s,g,{...m.mount?l:j(i)?o:Z(s)?{[s]:i}:i},n,i),k=s=>_e(y(m.mount?l:o,s,t.shouldUnregister?y(o,s,[]):[])),L=(s,i,n={})=>{const f=y(a,s);let u=i;if(f){const d=f._f;d&&(!d.disabled&&F(l,s,cs(i,d)),u=be(d.ref)&&T(i)?"":i,os(d.ref)?[...d.ref.options].forEach(h=>h.selected=u.includes(h.value)):d.refs?ye(d.ref)?d.refs.length>1?d.refs.forEach(h=>(!h.defaultChecked||!h.disabled)&&(h.checked=Array.isArray(u)?!!u.find(v=>v===h.value):u===h.value)):d.refs[0]&&(d.refs[0].checked=!!u):d.refs.forEach(h=>h.checked=h.value===u):Ce(d.ref)?d.ref.value="":(d.ref.value=u,d.ref.type||b.values.next({name:s,values:{...l}})))}(n.shouldDirty||n.shouldTouch)&&U(s,u,n.shouldTouch,n.shouldDirty,!0),n.shouldValidate&&ue(s)},z=(s,i,n)=>{for(const f in i){const u=i[f],d=`${s}.${f}`,h=y(a,d);(g.array.has(s)||A(u)||h&&!h._f)&&!ie(u)?z(d,u,n):L(d,u,n)}},K=(s,i,n={})=>{const f=y(a,s),u=g.array.has(s),d=W(i);F(l,s,d),u?(b.array.next({name:s,values:{...l}}),(N.isDirty||N.dirtyFields)&&n.shouldDirty&&b.state.next({name:s,dirtyFields:ce(o,l),isDirty:w(s,d)})):f&&!f._f&&!T(d)?z(s,d,n):L(s,d,n),Ye(s,g)&&b.state.next({...r}),b.values.next({name:m.mount?s:void 0,values:{...l}})},oe=async s=>{m.mount=!0;const i=s.target;let n=i.name,f=!0;const u=y(a,n),d=()=>i.type?Pe(u._f):As(s),h=v=>{f=Number.isNaN(v)||ie(v)&&isNaN(v.getTime())||re(v,y(l,n,v))};if(u){let v,D;const E=d(),se=s.type===Qe.BLUR||s.type===Qe.FOCUS_OUT,hs=!Ms(u._f)&&!t.resolver&&!y(r.errors,n)&&!u._f.deps||Is(se,y(r.touchedFields,n),r.isSubmitted,V,ae),Ae=Ye(n,g,se);F(l,n,E),se?(u._f.onBlur&&u._f.onBlur(s),C&&C(0)):u._f.onChange&&u._f.onChange(s);const Ve=U(n,E,se,!1),xs=!q(Ve)||Ae;if(!se&&b.values.next({name:n,type:s.type,values:{...l}}),hs)return N.isValid&&(t.mode==="onBlur"&&se?R():se||R()),xs&&b.state.next({name:n,...Ae?{}:Ve});if(!se&&Ae&&b.state.next({...r}),t.resolver){const{errors:Ke}=await G([n]);if(h(E),f){const bs=rs(r.errors,a,n),We=rs(Ke,a,bs.name||n);v=We.error,n=We.name,D=q(Ke)}}else I([n],!0),v=(await es(u,g.disabled,l,H,t.shouldUseNativeValidation))[n],I([n]),h(E),f&&(v?D=!1:N.isValid&&(D=await B(a,!0)));f&&(u._f.deps&&ue(u._f.deps),te(n,D,v,Ve))}},de=(s,i)=>{if(y(r.errors,i)&&s.focus)return s.focus(),1},ue=async(s,i={})=>{let n,f;const u=he(s);if(t.resolver){const d=await ne(j(s)?s:u);n=q(d),f=s?!u.some(h=>y(d,h)):n}else s?(f=(await Promise.all(u.map(async d=>{const h=y(a,d);return await B(h&&h._f?{[d]:h}:h)}))).every(Boolean),!(!f&&!r.isValid)&&R()):f=n=await B(a);return b.state.next({...!Z(s)||N.isValid&&n!==r.isValid?{}:{name:s},...t.resolver||!s?{isValid:n}:{},errors:r.errors}),i.shouldFocus&&!f&&me(a,de,s?u:g.mount),f},Le=s=>{const i={...m.mount?l:o};return j(s)?i:Z(s)?y(i,s):s.map(n=>y(i,n))},Oe=(s,i)=>({invalid:!!y((i||r).errors,s),isDirty:!!y((i||r).dirtyFields,s),error:y((i||r).errors,s),isValidating:!!y(r.validatingFields,s),isTouched:!!y((i||r).touchedFields,s)}),fs=s=>{s&&he(s).forEach(i=>P(r.errors,i)),b.state.next({errors:s?r.errors:{}})},Te=(s,i,n)=>{const f=(y(a,s,{_f:{}})._f||{}).ref,u=y(r.errors,s)||{},{ref:d,message:h,type:v,...D}=u;F(r.errors,s,{...D,...i,ref:f}),b.state.next({name:s,errors:r.errors,isValid:!1}),n&&n.shouldFocus&&f&&f.focus&&f.focus()},ms=(s,i)=>X(s)?b.values.subscribe({next:n=>s(_(void 0,i),n)}):_(s,i,!0),Fe=(s,i={})=>{for(const n of s?he(s):g.mount)g.mount.delete(n),g.array.delete(n),i.keepValue||(P(a,n),P(l,n)),!i.keepError&&P(r.errors,n),!i.keepDirty&&P(r.dirtyFields,n),!i.keepTouched&&P(r.touchedFields,n),!i.keepIsValidating&&P(r.validatingFields,n),!t.shouldUnregister&&!i.keepDefaultValue&&P(o,n);b.values.next({values:{...l}}),b.state.next({...r,...i.keepDirty?{isDirty:w()}:{}}),!i.keepIsValid&&R()},Re=({disabled:s,name:i,field:n,fields:f})=>{(J(s)&&m.mount||s||g.disabled.has(i))&&(s?g.disabled.add(i):g.disabled.delete(i),U(i,Pe(n?n._f:y(f,i)._f),!1,!1,!0))},Ne=(s,i={})=>{let n=y(a,s);const f=J(i.disabled)||J(t.disabled);return F(a,s,{...n||{},_f:{...n&&n._f?n._f:{ref:{name:s}},name:s,mount:!0,...i}}),g.mount.add(s),n?Re({field:n,disabled:J(i.disabled)?i.disabled:t.disabled,name:s}):x(s,!0,i.value),{...f?{disabled:i.disabled||t.disabled}:{},...t.progressive?{required:!!i.required,min:fe(i.min),max:fe(i.max),minLength:fe(i.minLength),maxLength:fe(i.maxLength),pattern:fe(i.pattern)}:{},name:s,onChange:oe,onBlur:oe,ref:u=>{if(u){Ne(s,i),n=y(a,s);const d=j(u.value)&&u.querySelectorAll&&u.querySelectorAll("input,select,textarea")[0]||u,h=Ts(d),v=n._f.refs||[];if(h?v.find(D=>D===d):d===n._f.ref)return;F(a,s,{_f:{...n._f,...h?{refs:[...v.filter(ke),d,...Array.isArray(y(o,s))?[{}]:[]],ref:{type:d.type,name:s}}:{ref:d}}}),x(s,!1,void 0,d)}else n=y(a,s,{}),n._f&&(n._f.mount=!1),(t.shouldUnregister||i.shouldUnregister)&&!(js(g.array,s)&&m.action)&&g.unMount.add(s)}}},qe=()=>t.shouldFocusError&&me(a,de,g.mount),ys=s=>{J(s)&&(b.state.next({disabled:s}),me(a,(i,n)=>{const f=y(a,n);f&&(i.disabled=f._f.disabled||s,Array.isArray(f._f.refs)&&f._f.refs.forEach(u=>{u.disabled=f._f.disabled||s}))},0,!1))},Me=(s,i)=>async n=>{let f;n&&(n.preventDefault&&n.preventDefault(),n.persist&&n.persist());let u=W(l);if(g.disabled.size)for(const d of g.disabled)F(u,d,void 0);if(b.state.next({isSubmitting:!0}),t.resolver){const{errors:d,values:h}=await G();r.errors=d,u=h}else await B(a);if(P(r.errors,"root"),q(r.errors)){b.state.next({errors:{}});try{await s(u,n)}catch(d){f=d}}else i&&await i({...r.errors},n),qe(),setTimeout(qe);if(b.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:q(r.errors)&&!f,submitCount:r.submitCount+1,errors:r.errors}),f)throw f},gs=(s,i={})=>{y(a,s)&&(j(i.defaultValue)?K(s,W(y(o,s))):(K(s,i.defaultValue),F(o,s,W(i.defaultValue))),i.keepTouched||P(r.touchedFields,s),i.keepDirty||(P(r.dirtyFields,s),r.isDirty=i.defaultValue?w(s,W(y(o,s))):w()),i.keepError||(P(r.errors,s),N.isValid&&R()),b.state.next({...r}))},Ie=(s,i={})=>{const n=s?W(s):o,f=W(n),u=q(s),d=u?o:f;if(i.keepDefaultValues||(o=n),!i.keepValues){if(i.keepDirtyValues){const h=new Set([...g.mount,...Object.keys(ce(o,l))]);for(const v of Array.from(h))y(r.dirtyFields,v)?F(d,v,y(l,v)):K(v,y(d,v))}else{if(De&&j(s))for(const h of g.mount){const v=y(a,h);if(v&&v._f){const D=Array.isArray(v._f.refs)?v._f.refs[0]:v._f.ref;if(be(D)){const E=D.closest("form");if(E){E.reset();break}}}}a={}}l=t.shouldUnregister?i.keepDefaultValues?W(o):{}:W(d),b.array.next({values:{...d}}),b.values.next({values:{...d}})}g={mount:i.keepDirtyValues?g.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},m.mount=!N.isValid||!!i.keepIsValid||!!i.keepDirtyValues,m.watch=!!t.shouldUnregister,b.state.next({submitCount:i.keepSubmitCount?r.submitCount:0,isDirty:u?!1:i.keepDirty?r.isDirty:!!(i.keepDefaultValues&&!re(s,o)),isSubmitted:i.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:u?{}:i.keepDirtyValues?i.keepDefaultValues&&l?ce(o,l):r.dirtyFields:i.keepDefaultValues&&s?ce(o,s):i.keepDirty?r.dirtyFields:{},touchedFields:i.keepTouched?r.touchedFields:{},errors:i.keepErrors?r.errors:{},isSubmitSuccessful:i.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},Be=(s,i)=>Ie(X(s)?s(l):s,i);return{control:{register:Ne,unregister:Fe,getFieldState:Oe,handleSubmit:Me,setError:Te,_executeSchema:G,_getWatch:_,_getDirty:w,_updateValid:R,_removeUnmounted:ge,_updateFieldArray:p,_updateDisabledField:Re,_getFieldArray:k,_reset:Ie,_resetDefaultValues:()=>X(t.defaultValues)&&t.defaultValues().then(s=>{Be(s,t.resetOptions),b.state.next({isLoading:!1})}),_updateFormState:s=>{r={...r,...s}},_disableForm:ys,_subjects:b,_proxyFormState:N,_setErrors:Q,get _fields(){return a},get _formValues(){return l},get _state(){return m},set _state(s){m=s},get _defaultValues(){return o},get _names(){return g},set _names(s){g=s},get _formState(){return r},set _formState(s){r=s},get _options(){return t},set _options(s){t={...t,...s}}},trigger:ue,register:Ne,handleSubmit:Me,watch:ms,setValue:K,getValues:Le,reset:Be,resetField:gs,clearErrors:fs,unregister:Fe,setError:Te,setFocus:(s,i={})=>{const n=y(a,s),f=n&&n._f;if(f){const u=f.refs?f.refs[0]:f.ref;u.focus&&(u.focus(),i.shouldSelect&&X(u.select)&&u.select())}},getFieldState:Oe}}function ts(e={}){const t=M.useRef(void 0),r=M.useRef(void 0),[a,o]=M.useState({isDirty:!1,isValidating:!1,isLoading:X(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:X(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...Ws(e),formState:a});const l=t.current.control;return l._options=e,Ds({subject:l._subjects.state,next:m=>{Ss(m,l._proxyFormState,l._updateFormState)&&o({...l._formState})}}),M.useEffect(()=>l._disableForm(e.disabled),[l,e.disabled]),M.useEffect(()=>{if(l._proxyFormState.isDirty){const m=l._getDirty();m!==a.isDirty&&l._subjects.state.next({isDirty:m})}},[l,a.isDirty]),M.useEffect(()=>{e.values&&!re(e.values,r.current)?(l._reset(e.values,l._options.resetOptions),r.current=e.values,o(m=>({...m}))):l._resetDefaultValues()},[e.values,l]),M.useEffect(()=>{e.errors&&l._setErrors(e.errors)},[e.errors,l]),M.useEffect(()=>{l._state.mount||(l._updateValid(),l._state.mount=!0),l._state.watch&&(l._state.watch=!1,l._subjects.state.next({...l._formState})),l._removeUnmounted()}),M.useEffect(()=>{e.shouldUnregister&&l._subjects.values.next({values:l._getWatch()})},[e.shouldUnregister,l]),t.current.formState=Ps(a,l),t.current}async function Hs(e){const{data:t,error:r}=await pe.from("users").select("*").eq("id",e).single();if(r)throw r;return t}async function $s(e){const{data:t,error:r}=await pe.from("users").update({full_name:e.fullName,email:e.email,phone:e.phone,image_url:e.imageUrl,updated_at:new Date().toISOString()}).eq("id",e.id).select().single();if(r)throw console.error("Error updating profile:",r),r;return{...t,fullName:t.full_name,imageUrl:t.image_url}}async function Qs(e){const{error:t}=await pe.auth.updateUser({password:e.newPassword});if(t)throw t}async function zs(e){const{data:t,error:r}=await pe.from("user_activity_logs").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(10);if(r)throw r;return t||[]}function rr(){const{user:e}=ws(),t=ps(),[r,a]=M.useState(!1),o=M.useRef(null),{register:l,handleSubmit:m,formState:{errors:g},reset:C}=ts({defaultValues:{fullName:"",email:(e==null?void 0:e.email)||"",phone:""}}),{register:O,handleSubmit:N,formState:{errors:b},reset:ae}=ts({defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),{data:V,isLoading:H}=He({queryKey:["profile",e==null?void 0:e.id],queryFn:()=>Hs(e==null?void 0:e.id),enabled:!!(e!=null&&e.id),onSuccess:x=>{x&&C({fullName:x.fullName||"",email:x.email||(e==null?void 0:e.email)||"",phone:x.phone||""})}}),{data:S}=He({queryKey:["userLogs",e==null?void 0:e.id],queryFn:()=>zs(e==null?void 0:e.id),enabled:!!(e!=null&&e.id)}),R=$e({mutationFn:$s,onSuccess:()=>{t.invalidateQueries({queryKey:["profile",e==null?void 0:e.id]})}}),I=$e({mutationFn:Qs,onSuccess:()=>{a(!1),ae()}}),p=async x=>{if(e!=null&&e.id)try{await R.mutateAsync({id:e.id,fullName:x.fullName,email:x.email,phone:x.phone})}catch(U){console.error("Error updating profile:",U)}},$=async x=>{if(e!=null&&e.id&&x.newPassword===x.confirmPassword)try{await I.mutateAsync({id:e.id,currentPassword:x.currentPassword,newPassword:x.newPassword})}catch(U){console.error("Error updating password:",U)}},Q=async x=>{var te;if(!(e!=null&&e.id))return;const U=(te=x.target.files)==null?void 0:te[0];if(U)try{new FormData().append("avatar",U),await R.mutateAsync({id:e.id,imageUrl:URL.createObjectURL(U)})}catch(G){console.error("Error uploading image:",G)}};return H?c.jsx("div",{className:"flex items-center justify-center h-96",children:c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"flex justify-between items-center",children:c.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Profile Settings"})}),c.jsx("div",{className:"bg-white shadow-sm rounded-lg",children:c.jsxs("div",{className:"p-6",children:[c.jsxs("div",{className:"flex items-center space-x-6 mb-8",children:[c.jsxs("div",{className:"relative",children:[c.jsx("img",{src:(V==null?void 0:V.imageUrl)||`https://ui-avatars.com/api/?name=${(V==null?void 0:V.fullName)||(e==null?void 0:e.email)||"User"}&background=random`,alt:(V==null?void 0:V.fullName)||"Profile",className:"h-24 w-24 rounded-full object-cover"}),c.jsx("button",{type:"button",onClick:()=>{var x;return(x=o.current)==null?void 0:x.click()},className:"absolute bottom-0 right-0 bg-indigo-600 rounded-full p-2 text-white hover:bg-indigo-700",children:c.jsx(_s,{className:"h-4 w-4"})}),c.jsx("input",{ref:o,type:"file",accept:"image/*",className:"hidden",onChange:Q})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900",children:(V==null?void 0:V.fullName)||"Complete Your Profile"}),c.jsx("p",{className:"text-sm text-gray-500",children:(V==null?void 0:V.email)||(e==null?void 0:e.email)})]})]}),c.jsxs("form",{onSubmit:m(p),className:"space-y-6",children:[c.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[c.jsxs("div",{children:[c.jsx("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),c.jsx("input",{type:"text",id:"fullName",...l("fullName",{required:"Full name is required"}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Enter your full name"}),g.fullName&&c.jsx("p",{className:"mt-1 text-sm text-red-600",children:g.fullName.message})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),c.jsx("input",{type:"email",id:"email",...l("email",{required:"Email is required"}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Enter your email"}),g.email&&c.jsx("p",{className:"mt-1 text-sm text-red-600",children:g.email.message})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Phone"}),c.jsx("input",{type:"tel",id:"phone",...l("phone"),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Enter your phone number"})]})]}),c.jsxs("div",{className:"flex justify-end space-x-3",children:[c.jsxs("button",{type:"button",onClick:()=>a(!0),className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:[c.jsx(Ns,{className:"h-4 w-4 mr-2"}),"Change Password"]}),c.jsx("button",{type:"submit",disabled:R.isPending,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:R.isPending?"Saving...":"Save Changes"})]})]}),r&&c.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:c.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[c.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"}),c.jsx("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:c.jsx("div",{className:"sm:flex sm:items-start",children:c.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:text-left w-full",children:[c.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"Change Password"}),c.jsxs("form",{onSubmit:N($),className:"mt-6 space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700",children:"Current Password"}),c.jsx("input",{type:"password",id:"currentPassword",...O("currentPassword",{required:"Current password is required"}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"}),b.currentPassword&&c.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.currentPassword.message})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700",children:"New Password"}),c.jsx("input",{type:"password",id:"newPassword",...O("newPassword",{required:"New password is required"}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"}),b.newPassword&&c.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.newPassword.message})]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm New Password"}),c.jsx("input",{type:"password",id:"confirmPassword",...O("confirmPassword",{required:"Please confirm your password",validate:x=>x===O("newPassword").value||"Passwords do not match"}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"}),b.confirmPassword&&c.jsx("p",{className:"mt-1 text-sm text-red-600",children:b.confirmPassword.message})]}),c.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[c.jsx("button",{type:"submit",disabled:I.isPending,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:I.isPending?"Updating...":"Update Password"}),c.jsx("button",{type:"button",onClick:()=>a(!1),className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm",children:"Cancel"})]})]})]})})})]})}),S&&S.length>0&&c.jsxs("div",{className:"mt-8",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Activity Log"}),c.jsx("div",{className:"flow-root",children:c.jsx("ul",{role:"list",className:"-mb-8",children:S.map((x,U)=>c.jsx("li",{children:c.jsxs("div",{className:"relative pb-8",children:[U<S.length-1&&c.jsx("span",{className:"absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200","aria-hidden":"true"}),c.jsxs("div",{className:"relative flex space-x-3",children:[c.jsx("div",{children:c.jsx("span",{className:"h-8 w-8 rounded-full bg-gray-400 flex items-center justify-center ring-8 ring-white",children:c.jsx(Fs,{className:"h-5 w-5 text-white"})})}),c.jsxs("div",{className:"min-w-0 flex-1 pt-1.5 flex justify-between space-x-4",children:[c.jsx("div",{children:c.jsx("p",{className:"text-sm text-gray-500",children:x.action})}),c.jsx("div",{className:"text-right text-sm whitespace-nowrap text-gray-500",children:new Date(x.createdAt).toLocaleString()})]})]})]})},x.id))})})]})]})})]})}export{rr as default};
